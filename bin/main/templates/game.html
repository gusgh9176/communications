<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<style>
	.card {
		width : 60px;
		height : 80px;
		margin : 20px;
    display : inline-block;
    text-align : center;
	}
  .card.odd { background : red; }
  .card.even { background : skyblue; }
</style>
</head>
<body>
	<form id="cardUI"></form>
	<form id="selectForm" style="visibility:hidden;">
		<input id="cardNum" type="text" readonly>선택한 카드</input>
		<button id="selectBtn" type="button">선택</button>
	</form>
	
	<div id=roundResult style="visibility:hidden;">Round <span>win!</span></div>
</body>

<script>
	$(function() {
		var cardUI = $('#cardUI');
    	var cardNum = $('#cardNum');
    	var id; //TODO

    	var isFirst = true;
    	var selectedNum = 0;
		
    	var gameHash = 0;
		var cards = new Array(1, 2, 3, 4, 5, 6, 7, 8);
    	showCard();
    	
    	function showCard() {
    		for(var i=0; i<8; i++) {
          		if(i%2!=1) {
            		cardUI.append("<div class='card odd'>" + cards[i] + "</div>");
          		}
          		else cardUI.append("<div class='card even'>" + cards[i] + "</div>");
        	}
    	}
    	
    	$('.card').click(function() {
    	    var num = $(this).val();
    	    this.cardNum.val(num);
    	});
    	
    	$('#selectBtn').click(function() {
    		this.selectedNum = this.cardNum.val();
    		$('#selectForm').css('visibility', 'hidden');
    	});
    	
    	/*
    	function selectCard() {
    		$('#selectCard').css('visibility','visible');
    	}
    	*/
    	
    	function afterRound() {
    		if(this.isFirst == true) {
    			//선공할 차례입니다 ->visible
    			//settimeout -> hidden
    			postCardNum();
    		}
    		else {
    			//상대의 선택을 기다리는 중
    			getColor();
    		}
    	}
    	
    	function postCardNum() {
        	$.ajax({
          		type : "POST",
          		dataType : "json",
          		url : "/game/cardnum",
          		data : JSON.stringify({user: , selectCard: selectedNum, gameHash: gameHash}),
          		success: function(winner) {
            		if(this.isFirst == true) {
            			getWinner();
            		}
            		else {
            			if(winner == "Game End") {
          					getDualResult();
          				}
          				else if(winner == this.id) {
          					this.isFirst = true;
          					//selectCardNum
          				}
          				else {
          					this.isFirst = false;
          				}
            		}
          		}
        	})
    	}

      	function getColor() {
        	$.ajax({
          		type : "GET",
          		dataType : "json",
          		url : "/game/color",
          		data : JSON.stringify({gameHash: gameHash}),
          		success : function(color) {
    				
          		},
          		timeout : 3000,
          		error : function(e) {
    				getColor();
          		}
    			//post로 데이터 전송 get으로 롱풀링받아오기
        	});
      	}
      	
      	function getWinner() {
      		$.ajax({
      			type : "GET",
      			datatype : "json",
      			url : "/game/winner",
      			data : JSON.stringify({gameHash: gameHash}),
      			success : function(winner) {
      				if(winner == "Game End") {
      					getDualResult();
      				}
      				else if(winner == this.id) {
      					this.isFirst = true;
      					//selectCardNum
      				}
      				else {
      					this.isFirst = false;
      				}
      			}
      			timeout : 3000,
      			error : function(e) {
      				getWinner();
      			}
      		})
      	}
      	
      	function getDualResult() {
      		$.ajax({
      			type : "GET",
      			datatype : "json",
      			url : "/game/dualResult",
      			data : JSON.stringify({gameHash: gameHash}),
      			success : function(result) {
      				if(result == this.id) {
      					alert("You win!");
      				}
      				else {
    					alert("Defeated..");
      				}
      			}
      		})
      	}
    	
	});
</script>

</html>
